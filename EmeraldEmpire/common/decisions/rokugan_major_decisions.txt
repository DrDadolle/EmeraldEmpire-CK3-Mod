##################################################
# DE JURE DECISIONS
##################################################
# Found New Major Clan
##################################################
found_major_clan_decision = {
	picture = "gfx/interface/illustrations/decisions/decision_found_kingdom.dds"
	major = yes
	ai_check_interval = 60
	desc = found_major_clan_decision_desc

	is_shown = {
		highest_held_title_tier = tier_duchy
		#NOT = { has_game_rule = off_custom_kingdoms }
		# Direct vassal of the emperor
		is_under_direct_e_rokugan_rule = yes
	}

	is_valid = {
		prestige_level >= 4
		# need top liege opinion high 
		liege = {
			opinion = { 
				value >= 50
				target = root
			}
		}
		#TODO how about alliances with others dukes ? instead of owning tier_duchy ?
		# any_ally with opinion > 20 and dukes will become your vassal
		OR = {
			# custom_description = {
			# 	text = found_kingdom_decision_three_duchies_held
			# 	any_held_title = {
			# 		count > 2
			# 		tier = tier_duchy
			# 	}
			# }
			AND = {
				custom_tooltip = {
					text = found_major_clan_decision_three_alliance_dukes
					any_ally = {
						count >= 3
						highest_held_title_tier = tier_duchy
						primary_title = { is_mercenary_company = no }
						primary_title = { is_holy_order = no }
						is_under_direct_e_rokugan_rule = yes
						opinion = { 
							value >= 25
							target = root
						}
					}
				}
				sub_realm_size >= 5
			}
			sub_realm_size >= 30
		}
	}

	is_valid_showing_failures_only = {
		is_available_adult = yes
		is_at_war = no
		is_imprisoned = no
	}

	cost = {
		gold = 300
		prestige = 500
		piety = 200
	}

	effect = {
		# TODO special event to choose the mon/animal of the new clan ?
		# Create Own Dynasty based on your first name ?
		# TODO replace with custom_kingdom effect !!

		# all allies with opinion > 25 will join as vassal in your new kingdom !
		create_custom_major_clan_effect = yes
		if = {
			limit = {
				is_ai = no
				NOT = { exists = global_var:found_major_clan_decision  }
			}
			set_global_variable = {
				name = found_major_clan_decision
				value = root
			}
			set_global_variable = {
				name = found_major_clan_decision_kingdom
				value = root.primary_title
			}
		}

		custom_description = {
			text = create_custom_major_clan_de_jure_changes_ally
		}

		##TODO : Add Dynasty & legitimacy ?
		add_legitimacy = major_legitimacy_gain
		dynasty = { add_dynasty_prestige = 1000 }
	}

	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 100
	}
}
##################################################
# Found New Minor Clan
##################################################
found_minor_clan_decision = {
	picture = "gfx/interface/illustrations/decisions/decision_found_kingdom.dds"
	major = yes
	ai_check_interval = 60
	desc = found_minor_clan_decision_desc

	is_shown = {
		highest_held_title_tier = tier_county
		#NOT = { has_game_rule = off_custom_kingdoms }
		# Direct vassal of the emperor
		is_under_direct_e_rokugan_rule = yes
	}

	is_valid = {
		prestige_level >= 3
		# need top liege opinion high 
		liege = {
			opinion = { 
				value >= 50
				target = root
			}
		}
	}

	is_valid_showing_failures_only = {
		is_available_adult = yes
		is_at_war = no
		is_imprisoned = no
	}

	cost = {
		gold = 150
		prestige = 250
		piety = 100
	}

	effect = {
		# TODO special event to choose the mon/animal of the new clan ?
		# Create Own Dynasty based on your first name ?
		# TODO replace with custom_duchy effect !!
		create_custom_minor_clan_effect = yes
		if = {
			limit = {
				is_ai = no
				NOT = { exists = global_var:found_minor_clan_decision  }
			}
			set_global_variable = {
				name = found_minor_clan_decision
				value = root
			}
			set_global_variable = {
				name = found_minor_clan_decision_duchy
				value = root.primary_title
			}
		}
	}

	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 100
	}
}

##################################################
# CLAIM DECISIONS
##################################################
# Reclaim Toshi Rambo
##################################################
decision_claim_toshi_rambo_crane = {
	picture = "gfx/interface/illustrations/decisions/decision_crane.dds" #TODO replace by "embrace death" art.

	title = decision_claim_toshi_rambo_crane
	selection_tooltip = decision_claim_toshi_rambo_crane_tooltip
	desc = decision_claim_toshi_rambo_crane_desc
	confirm_text = decision_claim_toshi_rambo_crane_confirm

	major = yes

    is_shown = {
        is_ruler = yes
        is_landed = yes

		# Is lion culture under lion daimyo, or the same with crane
		# OR = {
			AND = {
				is_under_k_crane_clan_rule_or_is_ruler = yes
				culture = { has_cultural_pillar = heritage_crane }
			}
        # 	AND = {
		# 		is_under_k_lion_clan_rule_or_is_ruler = yes
		# 		culture = { has_cultural_pillar = heritage_lion }
		# 	}
		# }

		#If Toshi Rambo holder not the same heritage as the character
        # NOR = {
			#TODO CA MARCHE PAS
			NAND = {
				c_toshi_rambo.holder = { culture = { has_cultural_pillar = heritage_crane }	}
				c_toshi_rambo.holder = { is_under_k_crane_clan_rule_or_is_ruler = yes }
			}

		#  	AND = {
		#  		c_toshi_rambo.holder = { culture = { has_cultural_pillar = heritage_lion }	}
		#  		culture = { has_cultural_pillar = heritage_lion }	
		#  	}
		# }

		#Do not get claim against imperial holder
		NOT = {
			c_toshi_rambo.holder = { is_imperial_family = yes	}
		}

		#Once per lifetime
		NOT = {
			has_character_flag = claimed_toshi_rambo_this_lifetime
		}
	}

	# Every 20 years ? Once per lifetime ?
	cooldown = { days = @get_ancestral_claim_cooldown_time }

    is_valid = {
		prestige_level >= 3
	}

    is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
	}

	cost = {
		prestige = 100
	}

    effect = {
		show_as_tooltip = {
			add_pressed_claim = title:c_toshi_rambo
		}
		hidden_effect = {
			add_character_flag = claimed_toshi_rambo_this_lifetime
		}
		trigger_event = {
			id = rokugan_major_clan_events_decision.0010
		}
	}

	ai_check_interval = 1

	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 1
		modifier = {
			add = 19
			primary_title.tier = tier_duchy
		}

		modifier = {
			add = 99
			primary_title.tier = tier_kingdom
		}
	}

}


##################################################
# CRANE CLAN
##################################################
# Avenge Yasuki War
##################################################
decision_avenge_yasuki_war = {
    picture = "gfx/interface/illustrations/decisions/decision_crane.dds"

    title = decision_avenge_yasuki_war
    selection_tooltip = decision_avenge_yasuki_war_tooltip
	desc = decision_avenge_yasuki_war_desc
	confirm_text = decision_avenge_yasuki_war_confirm

    major = yes

    is_shown = {
        is_ruler = yes
        is_landed = yes
        culture = { has_cultural_pillar = heritage_crane }
        
        # Yasuki duchy not already de jure in Crane lands
		title:d_yasuki = {
			NOT = {
				de_jure_liege = title:k_crane_clan
			}
		}

        # Can be done only once
        NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:avenge_yasuki_war
				}
			}
		}


    is_valid = {
		completely_controls = title:d_yasuki
		prestige_level >= 3
	}

    is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
		is_at_war = no
	}

    effect = {
		gain_heroic_legend_seed_tooltip_effect = yes
		show_as_tooltip = {
			unite_yasuki_to_crane_scripted_effect = yes
		}
		trigger_event = {
			id = rokugan_major_clan_events_decision.0001
		}
	}

	ai_check_interval = 1
	ai_potential = {
		always = yes
	}
	ai_will_do = {
		base = 100
	}
}

##################################################
# PHOENIX CLAN
##################################################
# Restore Snake Clan
##################################################
decision_restore_snake_clan = {
    picture = "gfx/interface/illustrations/decisions/decision_phoenix.dds"

    title = decision_restore_snake_clan
    selection_tooltip = decision_restore_snake_clan_tooltip
	desc = decision_restore_snake_clan_desc
	confirm_text = decision_restore_snake_clan_confirm

    major = yes

    is_shown = {
        is_ruler = yes
        is_landed = yes
        culture = { has_cultural_pillar = heritage_phoenix }
		has_title = title:c_chuda_province
		#After the end of the Snake Clan
		current_date >= 402.1.1
		dynasty:dynasty_chuda = {
			NOT = {
				any_house_member = {
					is_alive = yes
				}
			}
		}
        # Can be done only once
        NOT = {
			is_target_in_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:restore_snake_clan
			}
		}
	}


    is_valid = {
		# Is posseded OR mahotsukai
		OR = {
			has_trait = possessed_genetic 
			has_trait = witch
			has_trait = shindoshi
			religion = religion:jigoku_religion	
			#any_secret = { secret_type = secret_witch } #TODO keep it ?
		}
		# Castle of Shiro Chuda rebuilt
		title:b_shiro_chuda_ruins.title_province= {
			has_building_or_higher = castle_01
		}
		prestige_level >= 3
		#Has shadowlands faith ?
	}

    is_valid_showing_failures_only = {
		is_imprisoned = no
		is_available_adult = yes
		is_at_war = no
		NOT = {
			has_trait = zealous
		}
	}

    effect = {
		gain_heroic_legend_seed_tooltip_effect = yes
		show_as_tooltip = {
			reborn_snake_clan_scripted_effect = yes
		}
		trigger_event = {
			id = rokugan_minor_clan_restoration_decision.0001
		}
	}

	ai_check_interval = 1
	ai_potential = {
		always = yes
	}
	ai_will_do = {
		base = 100
	}
}
##################################################
# SNAKE CLAN
##################################################
# Avenge Snake Clan
##################################################
#TODO only if flag:restore_snake_clan = yes


