# Rokugan : removed reference to Hallicarnasse & Alexandria
# Replace Rome & Bagdhad grand City by Otosan Uchi
poi_capitals = {
	build_province_list = {
		every_kingdom = {
			limit = {
				this = this.holder.primary_title
			}
			holder.capital_province ?= {
				add_to_list = provinces
			}
		}
		every_empire = {
			limit = {
				this = this.holder.primary_title
			}
			holder.capital_province ?= {
				add_to_list = provinces
			}
		}
	}

	on_visit = {
		send_interface_toast = {
			title = poi_capitals.visit
			left_icon = root

			scope:province.barony.holder = {
				if = {
					limit = {
						primary_title = {
							tier = tier_empire
						}
					}
					save_temporary_scope_value_as = {
						name = xp_gain_amount
						value = travel_major_xp
					}
				}
				else = {
					save_temporary_scope_value_as = {
						name = xp_gain_amount
						value = travel_medium_xp
					}
				}

				if = {
					limit = {
						has_royal_court = no
					}
					root = {
						add_diplomacy_lifestyle_xp = scope:xp_gain_amount
					}
				}
				else_if = {
					limit = {
						has_court_type = court_diplomatic
					}
					root = {
						add_diplomacy_lifestyle_xp = scope:xp_gain_amount
					}
				}
				else_if = {
					limit = {
						has_court_type = court_warlike
					}
					root = {
						add_martial_lifestyle_xp = scope:xp_gain_amount
					}
				}
				else_if = {
					limit = {
						has_court_type = court_administrative
					}
					root = {
						add_stewardship_lifestyle_xp = scope:xp_gain_amount
					}
				}
				else_if = {
					limit = {
						has_court_type = court_intrigue
					}
					root = {
						add_intrigue_lifestyle_xp = scope:xp_gain_amount
					}
				}
				else_if = {
					limit = {
						has_court_type = court_scholarly
					}
					root = {
						add_learning_lifestyle_xp = scope:xp_gain_amount
					}
				}
				else_if = {
					limit = {
						has_court_type = court_tribal
					}
					root = {
						add_martial_lifestyle_xp = scope:xp_gain_amount
					}
				}
				else = {
					root = {
						add_diplomacy_lifestyle_xp = scope:xp_gain_amount
					}
				}
			}

			traveler_travel_xp_effect = {
				MIN = 3
				MAX = 5
			}
		}
	}
}

# Walls and Forts
poi_special_buildings_martial = {
	build_province_list = {
		every_special_building_province = {
			limit = {
				OR = {
					has_building_with_flag = { flag = travel_point_of_interest_martial }
					has_building_with_flag = { flag = travel_point_of_interest_martial_minor }
				}
			}
			add_to_list = provinces
		}
	}

	on_visit = {
		send_interface_toast = {
			title = poi_special_buildings.visit
			left_icon = root
			if = {
				# Walls and Forts
				limit = {
					scope:province = {
						has_building_with_flag = { flag = travel_point_of_interest_martial }
					}
				}
				add_martial_lifestyle_xp = travel_medium_xp
				traveler_danger_xp_effect = {
					MIN = 3
					MAX = 5
				}
			}
			else_if = {
				# Minor POI (mostly for multi-province defenses like Hadrian's wall)
				limit = {
					scope:province = {
						has_building_with_flag = { flag = travel_point_of_interest_martial_minor }
					}
				}
				add_martial_lifestyle_xp = miniscule_lifestyle_xp
				traveler_travel_xp_effect = {
					MIN = 1
					MAX = 1
				}
			}
			else = {
				# Rest / Fallback
				add_learning_lifestyle_xp = travel_medium_xp
				traveler_travel_xp_effect = {
					MIN = 3
					MAX = 5
				}
			}
		}
	}
}

# Universities & places of general learning
poi_special_buildings_learning = {
	build_province_list = {
		every_special_building_province = {
			limit = {
				has_building_with_flag = { flag = travel_point_of_interest_learning }
			}
			add_to_list = provinces
		}
	}

	on_visit = {
		send_interface_toast = {
			title = poi_special_buildings.visit
			left_icon = root

			if = {
				limit = {
					 has_lifestyle = diplomacy_lifestyle
				}
				add_diplomacy_lifestyle_xp = travel_medium_xp
			}
			else_if = {
				limit = {
					has_lifestyle = martial_lifestyle
				}
				add_martial_lifestyle_xp = travel_medium_xp
			}
			else_if = {
				limit = {
					has_lifestyle = stewardship_lifestyle
				}
				add_stewardship_lifestyle_xp = travel_medium_xp
			}
			else_if = {
				limit = {
					has_lifestyle = intrigue_lifestyle
				}
				add_intrigue_lifestyle_xp = travel_medium_xp
			}
			else_if = {
				limit = {
					has_lifestyle = learning_lifestyle
				}
				add_learning_lifestyle_xp = travel_medium_xp
			}
			else = {
				add_learning_lifestyle_xp = travel_medium_xp
			}

			traveler_travel_xp_effect = {
				MIN = 3
				MAX = 5
			}
		}
	}
}

# Religious sites
poi_special_buildings_religious = {
	build_province_list = {
		every_special_building_province = {
			limit = {
				has_building_with_flag = { flag = travel_point_of_interest_religious }
			}
			add_to_list = provinces
		}
	}

	on_visit = {
		send_interface_toast = {
			title = poi_special_buildings.visit
			left_icon = root

			add_learning_lifestyle_xp = travel_medium_xp
			if = {
				limit = {
					scope:province.barony ?= {
						is_holy_site_of = root.faith
					}
				}
				add_piety = medium_piety_gain
			}
			if = {
				limit = {
					has_trait = lifestyle_mystic
				}
				add_trait_xp = {
					trait = lifestyle_mystic
					value = lifestyle_mystic_xp_gain_minor_value
				}
			}

			traveler_travel_xp_effect = {
				MIN = 3
				MAX = 5
			}
		}
	}
}

# Palaces & Political places
poi_special_buildings_diplomatic = {
	build_province_list = {
		every_special_building_province = {
			limit = {
				has_building_with_flag = { flag = travel_point_of_interest_diplomatic }
			}
			add_to_list = provinces
		}
	}

	on_visit = {
		send_interface_toast = {
			title = poi_special_buildings.visit
			left_icon = root

			add_diplomacy_lifestyle_xp = travel_medium_xp
			traveler_travel_xp_effect = {
				MIN = 3
				MAX = 5
			}
		}
	}
}

poi_grand_city = {
	build_province_list = {
		province:139 = { add_to_list = provinces } #Otosan_Uchi
	}

	on_visit = {
		trigger_event = {
			on_action = on_visited_grand_city
		}
		if = {
			limit = {
				NOT = { scope:province.county.holder = root } #If I own it then it does not make sense to visit it.
			}
			custom_tooltip = poi_grand_city_visit_event_tt
		}
		if = {
			limit = {
				NOT = {
					has_trait = lifestyle_traveler
				}
			}
			send_interface_toast = {
				title = poi_grand_city.visit
				left_icon = root
				add_trait = lifestyle_traveler
				traveler_travel_xp_effect = {
					MIN = 1
					MAX = 3
				}
			}
		}
		else = {
			send_interface_toast = {
				title = poi_grand_city.visit
				left_icon = root

				traveler_travel_xp_effect = {
					MIN = 3
					MAX = 5
				}
			}
		}
	}
}

# Ancient / New wonders
poi_special_buildings_wonder = {
	build_province_list = {
		every_special_building_province = {
			limit = {
				has_building_with_flag = { flag = travel_point_of_interest_wonder }
			}
			add_to_list = provinces
		}
	}

	on_visit = {
		send_interface_toast = {
			title = poi_special_buildings.visit
			left_icon = root

			add_stewardship_lifestyle_xp = travel_medium_xp
			add_prestige = medium_prestige_gain
			if = {
				limit = {
					has_trait = lifestyle_mystic
				}
				add_trait_xp = {
					trait = lifestyle_mystic
					value = lifestyle_mystic_xp_gain_minor_value
				}
			}
			traveler_travel_xp_effect = {
				MIN = 3
				MAX = 5
			}
		}
	}
}

# Economic Buildings (mines, ports)
poi_special_buildings_economic = {
	build_province_list = {
		every_special_building_province = {
			limit = {
				has_building_with_flag = { flag = travel_point_of_interest_economic }
			}
			add_to_list = provinces
		}
	}

	on_visit = {
		send_interface_toast = {
			title = poi_special_buildings.visit
			left_icon = root

			add_stewardship_lifestyle_xp = travel_medium_xp
			traveler_danger_xp_effect = {
				MIN = 3
				MAX = 5
			}
		}
	}
}

#poi_mausoleum_at_halicarnassus = {
#	on_visit = {
#		send_interface_toast = {
#			title = poi_mausoleum_at_halicarnassus.visit
#			left_icon = root
#
#			add_stewardship_lifestyle_xp = travel_medium_xp
#			add_prestige = medium_prestige_gain
#			traveler_travel_xp_effect = {
#				MIN = 3
#				MAX = 5
#			}
#		}
#	}
#}

#poi_lighthouse_of_alexandria = {
#	build_province_list = {
#		province:6053 = {
#			add_to_list = provinces
#		}
#	}
#
#	on_visit = {
#		send_interface_toast = {
#			title = poi_lighthouse_of_alexandria.visit
#			left_icon = root
#
#			add_stewardship_lifestyle_xp = travel_medium_xp
#			add_prestige = medium_prestige_gain
#			traveler_travel_xp_effect = {
#				MIN = 3
#				MAX = 5
#			}
#		}
#	}
#}

# Natural features, e.g. Mount X, Lake X
poi_natural_feature = {
	build_province_list = {
		every_special_building_province = {
			limit = {
				has_building_with_flag = { flag = travel_point_of_interest_natural_feature }
			}
			add_to_list = provinces
		}
	}

	on_visit = {
		send_interface_toast = {
			title = poi_natural_feature.visit
			left_icon = root
			stress_impact = { base = minor_stress_impact_loss }
			if = {
				limit = {
					NOT = {
						has_trait = lifestyle_traveler
					}
				}
				send_interface_toast = {
					title = poi_grand_city.visit
					left_icon = root
					add_trait = lifestyle_traveler
					traveler_travel_xp_effect = {
						MIN = 1
						MAX = 3
					}
				}
			}
			else = {
				send_interface_toast = {
					title = poi_grand_city.visit
					left_icon = root
					traveler_travel_xp_effect = {
						MIN = 3
						MAX = 5
					}
				}
			}
		}
	}
}

# Legend stuff
poi_legend_capitals = {
	build_province_list = {
		every_legend = {
			limit = {
				OR = {
					legend_quality = illustrious
					legend_quality = mythical
				}
			}
			legend_owner.capital_province ?= {
				add_to_list = provinces
			}
		}
	}

	on_visit = {
		send_interface_toast = {
			title = poi_legend_capitals.visit
			left_icon = root

			add_diplomacy_lifestyle_xp = travel_medium_xp
			traveler_travel_xp_effect = {
				MIN = 3
				MAX = 5
			}
		}
	}
}

# Battle Stuff
poi_battles = {
	build_province_list = {
		every_in_global_list = {
			variable = battle_poi_list
			limit = {
				has_variable = battle_poi_winner
				has_variable = battle_poi_loser
				has_variable = battle_poi_date_day
				has_variable = battle_poi_date_month
				has_variable = battle_poi_date_year
				NOT = { has_travel_point_of_interest = poi_battles_historical }
			}
			add_to_list = provinces
		}
	}

	on_visit = {
		send_interface_toast = {
			title = poi_battles.visit
			left_icon = root

			if = {
				limit = {
					OR = {
						has_variable = battle_poi_trait_gained
						number_of_commander_traits > 1
					}
				}
				add_poi_martial_experience_effect = yes
			}
			else = {
				poi_lifestyle_experience_effect = {
					LIFESTYLE = martial
					VALUE = travel_minor_lifestyle_xp
				}
			}
			# Prestige for Wanderers
			wanderer_lifestyle_destination_effect = yes
		}

		if = {
			limit = {
				NOR = {
					has_variable = battle_poi_trait_gained
					number_of_commander_traits > 1
				}
			}
			scope:province = {
				random_list = {
					80 = {
						root = { add_poi_martial_experience_effect = yes }
					}
					20 = {
						switch = {
							trigger = terrain
							forest = { battle_poi_trait_effect = { TRAIT = forest_fighter } }
							taiga = { battle_poi_trait_effect = { TRAIT = forest_fighter } }
							farmlands = { battle_poi_trait_effect = { TRAIT = open_terrain_expert } }
							plains = { battle_poi_trait_effect = { TRAIT = open_terrain_expert } }
							steppe = { battle_poi_trait_effect = { TRAIT = open_terrain_expert } }
							hills = { battle_poi_trait_effect = { TRAIT = rough_terrain_expert } }
							mountains = { battle_poi_trait_effect = { TRAIT = rough_terrain_expert } }
							wetlands = { battle_poi_trait_effect = { TRAIT = rough_terrain_expert } }
							drylands = { battle_poi_trait_effect = { TRAIT = desert_warrior } }
							desert = { battle_poi_trait_effect = { TRAIT = desert_warrior } }
							desert_mountains = { battle_poi_trait_effect = { TRAIT = desert_warrior } }
							oasis = { battle_poi_trait_effect = { TRAIT = desert_warrior } }
							jungle = { battle_poi_trait_effect = { TRAIT = jungle_stalker } }
							floodplains = { battle_poi_trait_effect = { TRAIT = flexible_leader } }
						}
						root = {
							set_variable = battle_poi_trait_gained
						}
					}
				}
			}
		}

		traveler_danger_xp_effect = {
			MIN = 1
			MAX = 3
		}

		visiting_poi_effect = yes
	}
}

poi_battles_historical = {
	build_province_list = {
		#L5R Disabled
		# Note, please try to keep these in chronological order
#		if = { # Battle of Yarmuk
#			limit = { game_start_date > 636.8.20 }
#			province:5954 = { add_to_list = provinces }
#		}
#		if = { # Battle of Aror
#			limit = { game_start_date > 711.1.1 }
#			province:1175 = { add_to_list = provinces }
#		}
#		if = { # Battle of Tours
#			limit = { game_start_date > 732.10.10 }
#			province:2253 = { add_to_list = provinces }
#		}
#		if = { # Battle of Talas
#			limit = { game_start_date > 751.1.1 }
#			province:7132 = { add_to_list = provinces }
#		}
#		if = { # Battle of Lechfeld
#			limit = { game_start_date > 955.8.10 }
#			province:2778 = { add_to_list = provinces }
#		}
#		if = { # Battle of Svolder
#			limit = { game_start_date > 999.9.9 }
#			province:2811 = { add_to_list = provinces }
#		}
#		if = { # Battle of Dandanaqan
#			limit = { game_start_date > 1040.5.23 }
#			province:4008 = { add_to_list = provinces }
#		}
#		if = { # Battle of Civitate
#			limit = { game_start_date > 1053.6.18 }
#			province:2605 = { add_to_list = provinces }
#		}
#		if = { # The Battle of Stamford Bridge
#			limit = { game_start_date > 1066.9.25 }
#			province:1595 = { add_to_list = provinces }
#		}
#		if = { # The Battle of Hastings
#			limit = { game_start_date > 1066.10.14 }
#			province:1509 = { add_to_list = provinces }
#		}
#		if = { # The Battle of Manzikert
#			limit = { game_start_date > 1071.8.26 }
#			province:701 = { add_to_list = provinces }
#		}



	
		#L5R Modified
		if = { # Battle of Last Stand vs the Maw b_watch_tower_east
			limit = { game_start_date > 716.1.1 }
			province:177 = { add_to_list = provinces }
		}
		if = { # Return of the Kirin b_shimomura
			limit = { game_start_date > 817.1.1 }
			province:159 = { add_to_list = provinces }
		}
	}

	on_visit = {
		send_interface_toast = {
			title = travel_point_historical_name_visit_message
			left_icon = root

			if = {
				limit = {
					OR = {
						has_variable = battle_poi_trait_gained
						number_of_commander_traits > 1
					}
				}
				add_poi_martial_experience_effect = yes
			}
			else = {
				poi_lifestyle_experience_effect = {
					LIFESTYLE = martial
					VALUE = travel_minor_lifestyle_xp
				}
			}

			if = {
				limit = {
					NOR = {
						has_variable = battle_poi_trait_gained
						number_of_commander_traits > 1
					}
				}
				random_list = {
					80 = {
						add_poi_martial_experience_effect = yes
					}
					20 = {
						scope:province = {
							switch = {
								trigger = this
								#L5R Disabled
#								# Tours
#								province:2253 = { battle_poi_trait_effect = { TRAIT = unyielding_defender } }
#								# Lechfeld
#								province:2778 = { battle_poi_trait_effect = { TRAIT = open_terrain_expert } }
#								# Hastings
#								province:1509 = { battle_poi_trait_effect = { TRAIT = aggressive_attacker } }
#								# Stamford Bridge
#								province:1595 = { battle_poi_trait_effect = { TRAIT = organizer } }
#								# Manzikert
#								province:701 = { battle_poi_trait_effect = { TRAIT = flexible_leader } }
#								# Yarmuk
#								province:5954 = { battle_poi_trait_effect = { TRAIT = reckless } }
#								# Dandanaqan
#								province:4008 = { battle_poi_trait_effect = { TRAIT = desert_warrior } }
#								# Battle of Aror
#								province:1175 = { battle_poi_trait_effect = { TRAIT = flexible_leader } }
#								# Battle of Svolder
#								province:2811 = { battle_poi_trait_effect = { TRAIT = holy_warrior } }
#								# Battle of Civitate
#								province:2605 = { battle_poi_trait_effect = { TRAIT = open_terrain_expert } }
#								# Battle of Talas
#								province:7132 = { battle_poi_trait_effect = { TRAIT = desert_warrior } }

								#L5R Added
								# Battle of Last Stand vs the Maw b_watch_tower_east
								province:177 = { battle_poi_trait_effect = { TRAIT = unyielding_defender } }
								# Return of the Kirin b_shimomura
								province:159 = { battle_poi_trait_effect = { TRAIT = open_terrain_expert } }
							}
						}
						set_variable = battle_poi_trait_gained
					}
				}
			}

			traveler_danger_xp_effect = {
				MIN = 1
				MAX = 3
			}

			# Prestige for Wanderers
			wanderer_lifestyle_destination_effect = yes
		}

		visiting_poi_effect = yes
	}
}


