namespace = shadowlands_struggle

# 0000-0999 - Maintenance
# 1000-1999 - Decision Events
# 2000-2999 - Minor Shadowlands Events
# 3000-3999 - Major Shadowlands Events
# 4000-4999 - Invasion Balrog Events

## Maintenance
# Struggle Introduction
shadowlands_struggle.0001 = {
	content_source = l5r_dlc
	type = character_event
	window = fullscreen_event
	title = shadowlands_struggle.0001.t
	desc = shadowlands_struggle.0001.desc
	theme = war
	override_background = { reference = shadowlands_struggle_start }

	trigger = {
		is_ai = no
 	}

	option = {
		name = shadowlands_struggle.0001.a
		trigger = {
			faith_is_good = yes
		}
		clicksound = "event:/DLC/FP2/SFX/UI/fp2_struggle_start_select"
	}
	option = {
		name = shadowlands_struggle.0001.b
		trigger = {
			faith_is_evil = yes
		}
		clicksound = "event:/DLC/FP2/SFX/UI/fp2_struggle_start_select"
	}

	option = {
		name = shadowlands_struggle.0001.c
		trigger = {
			faith_is_neutral = yes
		}
		clicksound = "event:/DLC/FP2/SFX/UI/fp2_struggle_start_select"
	}
}


# Struggle On Change Phase
# The Great Invasion Begin
shadowlands_struggle.0002 = {
	content_source = l5r_dlc
	type = character_event
	window = fullscreen_event
	title = shadowlands_struggle.0002.t
	desc = shadowlands_struggle.0002.desc
	theme = war
	override_background = { reference = shadowlands_struggle_start }

	trigger = {
		is_ai = no
		any_character_struggle = {
			is_struggle_type = shadowlands_struggle
			is_struggle_phase = struggle_shadowlands_phase_invasion
		}
 	}
	
	option = {
		name = shadowlands_struggle.0002.a
		trigger = {
			faith_is_good = yes
		}
	}
	option = {
		name = shadowlands_struggle.0002.b
		trigger = {
			faith_is_evil = yes
		}
	}
	option = {
		name = shadowlands_struggle.0002.c
		trigger = {
			faith_is_neutral = yes
		}
	}
}


## Decisions
# Struggle Ending : Shadowlands Domination
shadowlands_struggle.1000 = {
	content_source = l5r_dlc
	type = character_event
	window = fullscreen_event
	title = shadowlands_struggle.1000.t
	desc = shadowlands_struggle.1000.desc
	theme = war
	override_background = { reference = shadowlands_struggle_start }

	trigger = {
		is_ai = no
 	}

	option = {
		name = shadowlands_struggle.1000.a
		trigger = {
			faith_is_good = yes
		}
	}
	option = {
		name = shadowlands_struggle.1000.b
		trigger = {
			faith_is_evil = yes
		}
	}

	option = {
		name = shadowlands_struggle.1000.c
		trigger = {
			faith_is_neutral = yes
		}
	}
}

# Struggle Ending : Crab Domination
shadowlands_struggle.1001 = {
	content_source = l5r_dlc
	type = character_event
	window = fullscreen_event
	title = shadowlands_struggle.1001.t
	desc = shadowlands_struggle.1001.desc
	theme = war
	override_background = { reference = shadowlands_struggle_start }

	trigger = {
		is_ai = no
 	}

	option = {
		name = shadowlands_struggle.1001.a
		trigger = {
			faith_is_good = yes
		}
	}
	option = {
		name = shadowlands_struggle.1001.b
		trigger = {
			faith_is_evil = yes
		}
	}

	option = {
		name = shadowlands_struggle.1001.c
		trigger = {
			faith_is_neutral = yes
		}
	}
}

# Struggle Ending : Spider Domination
shadowlands_struggle.1002 = {
	content_source = l5r_dlc
	type = character_event
	window = fullscreen_event
	title = shadowlands_struggle.1002.t
	desc = shadowlands_struggle.1002.desc
	theme = crown
	override_background = { reference = shadowlands_struggle_start }

	trigger = {
		is_ai = no
 	}

	option = {
		name = shadowlands_struggle.1002.a
		trigger = {
			faith_is_good = yes
		}
	}
	option = {
		name = shadowlands_struggle.1002.b
		trigger = {
			faith_is_evil = yes
		}
	}

	option = {
		name = shadowlands_struggle.1002.c
		trigger = {
			faith_is_neutral = yes
		}
	}
}

##########
#### Invasion of Crab Clan Event
shadowlands_struggle.2000 = { # Invasion of Crab Clan
	content_source = l5r_dlc
	type = character_event
	title = shadowlands_struggle.2000.t
	desc = shadowlands_struggle.2000.desc
	theme = war
	left_portrait = {
		character = root
		animation = personality_callous
	}
	right_portrait = {
		character = character:crab_clan
		animation = anger
	}

	
	immediate = {
		# Target top liege
		if = {
			limit = { 
				exists = title:k_crab_clan.holder 
				exists = title:e_rokugan.holder 
				title:k_crab_clan.holder.top_liege = title:e_rokugan.holder 
			}
			title:e_rokugan.holder = { save_scope_as = crab_clan }
		}
		else_if = {
			limit = { exists = title:k_crab_clan.holder }
			title:k_crab_clan.holder = { save_scope_as = crab_clan }
		}
		else_if = {
			limit = { exists = title:e_rokugan.holder }
			title:e_rokugan.holder = { save_scope_as = crab_clan }
		}
	}
	
	option = {
		name = shadowlands_struggle.2000.a

		show_as_tooltip = {
			spawn_army_invasion_crab_clan = yes
		}

		start_war = {
			casus_belli = invasion_of_crab_clan_cb
			target = scope:crab_clan
			target_title = title:k_crab_clan
		}
		# TODO : ask for help ? Dunno
		# scope:crab_clan = {
		# 	trigger_event = {
		# 		id = shadowlands_struggle.2001
		# 		days = 1
		# 	}
		# }
		
	}
}
# Victory against Crab Clan. Invasion Won
shadowlands_struggle.2001 = { 
	content_source = l5r_dlc
	type = character_event
	title = shadowlands_struggle.2001.t
	desc = shadowlands_struggle.2001.desc
	theme = war

	right_portrait = {
		character = root
		animation = personality_callous
	}
	
	option = {
		name = shadowlands_struggle.2001.a
		# Remove the character modifier
		remove_character_modifier = shadowlands_invasion_leader_modifier
	}
}
# Notification of Crab Clan's defeat. Invasion Won
shadowlands_struggle.2002 = { 
	content_source = l5r_dlc
	type = character_event
	title = shadowlands_struggle.2002.t
	desc = shadowlands_struggle.2002.desc
	theme = war


	left_portrait = {
		character = root
		animation = worry
	}
	right_portrait = {
		character = scope:attacker
		animation = personality_callous
	}
	
	option = {
		name = shadowlands_struggle.2002.a
	}
	option = {
		name = shadowlands_struggle.2002.b
	}
}

# Defeat against Crab Clan. Invasion Failed
shadowlands_struggle.2003 = { 
	content_source = l5r_dlc
	type = character_event
	title = shadowlands_struggle.2003.t
	desc = shadowlands_struggle.2003.desc
	theme = war

	right_portrait = {
		character = root
		animation = personality_callous
	}
	
	option = {
		name = shadowlands_struggle.2003.a
		# Remove the character modifier
		remove_character_modifier = shadowlands_invasion_leader_modifier
		#destroy all empire/ kingdom / duchy titles within e_shadowlands
		custom_description_no_bullet = {
			text = shadowlands_duchies_kingdoms_empires_explodes
		}
		hidden_effect = {
			# Every held titles of duchy or above
			every_held_title = {
				limit = {
					tier >= tier_duchy
				}
				add_to_temporary_list = titles_to_destroy
			}

			every_in_list = {
				list = titles_to_destroy
				scope:defender = {
					destroy_title = prev
				}
			}

			# Every duchy or above vassal will receive a similar event, with title destruction
			every_vassal_or_below = {
				every_held_title = {
					limit = {
						tier >= tier_duchy
					}
					trigger_event = shadowlands_struggle.2005
				}
			}

			
		}
	}
}
# Notification of Crab Clan's victory. Invasion Failed
shadowlands_struggle.2004 = { 
	content_source = l5r_dlc
	type = character_event
	title = shadowlands_struggle.2004.t
	desc = shadowlands_struggle.2004.desc
	theme = war


	left_portrait = {
		character = root
		animation = worry
	}
	right_portrait = {
		character = scope:attacker
		animation = personality_callous
	}
	
	option = {
		name = shadowlands_struggle.2004.a
	}
	option = {
		name = shadowlands_struggle.2004.b
	}
}

# Sub event for vassal (as well as indirect ones) of the guy which failed the invasion
# Inform them that  all their duchy titles or above will be destroyed
shadowlands_struggle.2005 = { 
	content_source = l5r_dlc
	type = character_event
	title = shadowlands_struggle.2005.t
	desc = shadowlands_struggle.2005.desc
	theme = war


	left_portrait = {
		character = root
		animation = worry
	}
	right_portrait = {
		character = scope:attacker
		animation = personality_callous
	}
	
	option = {
		name = shadowlands_struggle.2005.a

		custom_description_no_bullet = {
			text = shadowlands_duchies_kingdoms_empires_explodes
		}
		hidden_effect = {
			# Every held titles of duchy or above
			every_held_title = {
				limit = {
					tier >= tier_duchy
				}
				add_to_temporary_list = titles_to_destroy
			}

			every_in_list = {
				list = titles_to_destroy
				scope:defender = {
					destroy_title = prev
				}
			}
		}
	}
}

# Notification to Crab Clan's ruler to add them as ally in the invasion war.
shadowlands_struggle.2010 = { 
	content_source = l5r_dlc
	type = character_event
	title = shadowlands_struggle.2010.t
	desc = shadowlands_struggle.2010.desc
	theme = war

	left_portrait = {
		character = root
		animation = worry
	}
	right_portrait = {
		character = scope:attacker
		animation = personality_callous
	}
	
	option = {
		name = shadowlands_struggle.2010.a
		scope:war = { add_defender = root }

		ai_chance = {
			base = 100
		}
	}
	option = {
		name = shadowlands_struggle.2010.b
		stress_impact = {
			craven = medium_stress_loss
		}
		stress_impact = {
			brave = major_stress_gain
		}
		dynasty = {
			add_dynasty_prestige = major_dynasty_prestige_loss
		}
		add_prestige = monumental_prestige_loss
		add_piety = major_piety_loss

		ai_chance = {
			base = 0
		}
	}
}


